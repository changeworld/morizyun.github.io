<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: RMagick | 酒と泪とRubyとRailsと]]></title>
  <link href="http://morizyun.github.io/blog/categories/rmagick/atom.xml" rel="self"/>
  <link href="http://morizyun.github.io/"/>
  <updated>2015-12-30T20:26:52+09:00</updated>
  <id>http://morizyun.github.io/</id>
  <author>
    <name><![CDATA[morizyun]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RubyでRMagickを使って正方形のサムネイルを作成]]></title>
    <link href="http://morizyun.github.io/blog/rmagic-square-thumbnail-ruby/"/>
    <updated>2014-04-16T22:15:00+09:00</updated>
    <id>http://morizyun.github.io/blog/rmagic-square-thumbnail-ruby</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4844335766/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4844335766&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=4844335766&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=4844335766" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />Rmagickを使って縦横の比率がバラバラの画像から、正方形のサムネイルを切り出すRubyのサンプルソースです。以前は大きな画像を縮小するだけでしたが、今回は縦・横の両方が予定のサイズ以上なら切り出して正方形、それよりも小さい場合は空白で埋めて画像を拡大しないように調整。</p>

<!-- more -->


<br style="clear:both;"/>


<h2>ソースコード</h2>

<p>サンプルソースでは次のことをしています。</p>

<pre>
(1) サンプルの画像をダウンロード
(2) Rmagickを使って正方形のサムネイル画像を切り出し
(3) ./data/フォルダにサムネイル画像を保存
</pre>


<p>{% codeblock lang:ruby %}
require 'rubygems'
require 'open-uri'
require 'rmagick' # gem install rmagick</p>

<p>def shrink_to_fill(image, width, height)
  image.resize_to_fill!(width, height)
  image
end</p>

<p>def cover_white(image, width, height)
  new_width = (image.columns &lt; width) ? image.columns : width
  new_height = (image.rows &lt; height) ? image.rows : height</p>

<p>  image.resize_to_fit!(new_width, new_height)
  image_out = Magick::Image.new(width, height)
  image_out.background_color = '#ffffff'
  image_out.composite!(image, Magick::CenterGravity, Magick::OverCompositeOp)
  image_out
end</p>

<h1>flickr上のクリエティブ・コモンズの画像</h1>

<p>image_url = "http://farm4.staticflickr.com/3319/3584524809_f791a000e0_z.jpg"
width = 300
height = 300</p>

<p>res = open(image_url)
if res.content_type =~ /<sup>image/</sup>
  thumb = Magick::Image.from_blob(res.read).shift</p>

<p>  if thumb.columns &lt; width or thumb.rows &lt; height</p>

<pre><code>thumb_out = cover_white(thumb, width, height)
</code></pre>

<p>  else</p>

<pre><code>thumb_out = shrink_to_fill(thumb, width, height)
</code></pre>

<p>  end</p>

<p>  open("./out_thumb.png", 'w').print thumb_out.to_blob
end
{% endcodeblock %}</p>

<p>では動作確認です。</p>

<p><img src="http://farm4.staticflickr.com/3319/3584524809_f791a000e0_z.jpg" width="640" height="480" alt="Another dog"></p>

<p>上の画像(640x480)が下のように正方形(300x300)になりました。</p>

<p><img src="https://farm4.staticflickr.com/3728/13894893705_83da38b547.jpg" width="300" height="300" alt="out_thumb"></p>

<h2>Special Thanks</h2>

<p><a href="http://d.hatena.ne.jp/kaorumori/20121202/1354429975">RMagickで正方形のサムネイルを作成する方法</a></p>

<p><a href="http://essaysinidleness.net/www/study_ruby/20121116132712.html">Rmagickで画像を比率を保って縮小、そして正方形に</a></p>

<p><a href="https://gist.github.com/494174">gist: 494174</a></p>

<h2>変更来歴</h2>

<p>(12/12/31 10:15) 「補足：画像を単純にDLしたい場合」を追加<br/>
(14/04/16 23:10) サンプルソースを書き直し<br/></p>
]]></content>
  </entry>
  
</feed>
