<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: thor | 酒と泪とRubyとRailsと]]></title>
  <link href="http://morizyun.github.io/blog/categories/thor/atom.xml" rel="self"/>
  <link href="http://morizyun.github.io/"/>
  <updated>2015-07-05T18:40:53+09:00</updated>
  <id>http://morizyun.github.io/</id>
  <author>
    <name><![CDATA[morizyun]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[thor Rubyで簡単にshellコマンドが作れる！]]></title>
    <link href="http://morizyun.github.io/blog/thor-shell-command-easy-ruby-gem/"/>
    <updated>2014-12-23T21:00:00+09:00</updated>
    <id>http://morizyun.github.io/blog/thor-shell-command-easy-ruby-gem</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/477416366X/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=477416366X&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=477416366X&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=477416366X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
この前作ったFacebookやTwitter、はてなブックマークのカウントを収集してくれるGem『<strong><a href="https://github.com/morizyun/scouter">scouter</a></strong>』のコマンドを作った際にお世話になった『<strong><a href="https://github.com/erikhuda/thor">erikhuda/thor</a></strong>』が思っていた以上に高機能だったので忘れないようにメモ記事です！</p>

<!-- more -->


<br style="clear:both;"/>


<p>{% include custom/google_ads_yoko_naga.html %}</p>

<h2>インストール手順</h2>

<p>いつもどおり<code>Gemfile</code>に以下を追加して、<code>bundle install</code>を実行してください。</p>

<p>{% codeblock lang:bash %}</p>

<h1>command-line interfaces</h1>

<p>gem 'thor'
{% endcodeblock %}</p>

<p>もしくはコマンドライン上で以下のコマンドを実行。</p>

<p>{% codeblock lang:bash %}
gem install thor
{% endcodeblock %}</p>

<h2>基本的な使い方</h2>

<p><code>testest</code>を作成して以下コードを記述します。</p>

<p>{% codeblock lang:ruby %}</p>

<h1>!/usr/bin/env ruby</h1>

<h1>coding: utf-8</h1>

<p>require 'rubygems'
require 'thor'</p>

<p>class Command &lt; Thor
  default_command :example</p>

<p>  desc 'example', 'an example task'
  option :file, type: :string, aliases: '-f', desc: 'Delete the file after parsing it'
  def example</p>

<pre><code>puts "executing! argument is #{options[:file]}!"
</code></pre>

<p>  end
end</p>

<p>Command.start
{% endcodeblock %}</p>

<p>早速作成したコマンドを実行してみます！</p>

<p>{% codeblock lang:bash %}</p>

<h1>初回のみ実行権限を付与</h1>

<p>chmod a+x testest</p>

<p>./testest -f sample.file</p>

<h1>=> executing! argument is sample.file!</h1>

<p>{% endcodeblock %}</p>

<h2>引数とオプションの追加</h2>

<p>先ほどのコマンドに引数と、オプションを足してみます。</p>

<p>{% codeblock lang:ruby %}</p>

<h1>!/usr/bin/env ruby</h1>

<h1>coding: utf-8</h1>

<p>require 'rubygems'
require 'thor'</p>

<p>class Command &lt; Thor
  default_command :example</p>

<p>  desc 'example', 'an example task'
  option :file, type: :string, aliases: '-f', desc: 'Delete the file after parsing it'
  method_option :delete, aliases: '-d', desc: 'Delete the file after parsing it'
  def example</p>

<pre><code>if options[:delete]
  puts "executing! argument is #{options[:file]} and delete option is true!"
else
  puts "executing! argument is #{options[:file]} and delete option is false!"
end
</code></pre>

<p>  end
end</p>

<p>Command.start
{% endcodeblock %}</p>

<p>では先ほど作ったコマンドを実行してみます。</p>

<p>{% codeblock lang:bash %}</p>

<h1>-d(--delete) オプションを付けない場合</h1>

<p>./testest -f 'sample.file'</p>

<h1>=> executing! argument is sample.file and delete option is false!</h1>

<h1>-d(--delete) オプションを付ける場合</h1>

<p>./testest -f 'sample.file' -d</p>

<h1>=> executing! argument is sample.file and delete option is true!</h1>

<p>{% endcodeblock %}</p>

<h2>Railsの環境情報を取得</h2>

<p>Railsの環境情報を使ったコマンドも簡単に作成できます。</p>

<p>{% codeblock lang:ruby %}
class Example &lt; Thor
  include Thor::Actions
  desc "init_example", " you can write some description"
  method_options :force => :boolean, :aliases => "-f"
  def init_example</p>

<pre><code># Railsの環境情報を読み込み
require './config/environment'

if options[:force]
  if yes?("WARN: Are u sure ?",:yellow)
    delete_sql = "truncate examples"
    say "delete all datas from examples ... ", :red
    ActiveRecord::Base.connection.execute(delete_sql)
  else
    say "Cancel!", :red
    return
  end
end

#TODO
</code></pre>

<p>  end
end
{% endcodeblock %}</p>

<h2>Namespaceを付け足す</h2>

<p>thorを使いこなす過程でNamespaceが欲しくなるかもです。そんな場合はこちら。</p>

<p>{% codeblock lang:bash %}
module Sinatra
  class App &lt; Thor</p>

<pre><code>namespace :myapp
def install
  # task code
end
# other tasks
</code></pre>

<p>  end
end
{% endcodeblock %}</p>

<p>ちなみに、実行コマンドは以下の通りです。</p>

<p>{% codeblock lang:bash %}
thor myapp:install
{% endcodeblock %}</p>

<h2>Thor GitHub Wiki</h2>

<p>ThorのGitHubのWikiはこちら！</p>

<p><strong><a href="https://github.com/erikhuda/thor/wiki">Home erikhuda/thor Wiki - GitHub</a></strong></p>

<p>{% include custom/google_ads_yoko_naga.html %}</p>

<h2>Special Thanks</h2>

<p><strong><a href="http://qiita.com/succi0303/items/32560103190436c9435b">Ruby - Thorの使い方まとめ - Qiita</a></strong></p>

<p><strong><a href="http://qiita.com/rosylilly/items/d7f9667f3998cfc420d1">Ruby で作る、簡単 CLI ツールのススメ - Qiita</a></strong></p>

<p><strong><a href="http://hibariya.github.io/entries/20111025/a0.html">Thorで簡単にコマンドラインアプリをつくる - Joy Luck Crab</a></strong></p>
]]></content>
  </entry>
  
</feed>
