<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: GemJam | 酒と泪とRubyとRailsと]]></title>
  <link href="http://morizyun.github.io/blog/categories/gemjam/atom.xml" rel="self"/>
  <link href="http://morizyun.github.io/"/>
  <updated>2016-01-12T23:56:30+09:00</updated>
  <id>http://morizyun.github.io/</id>
  <author>
    <name><![CDATA[morizyun]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ソースコード・リーディングしよう！[GemJam][ActiveSupport]]]></title>
    <link href="http://morizyun.github.io/blog/library-source-code-reading-acctive-support/"/>
    <updated>2014-12-28T12:10:00+09:00</updated>
    <id>http://morizyun.github.io/blog/library-source-code-reading-acctive-support</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/B00DT4DY0M/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00DT4DY0M&linkCode=as2&tag=morizyun00-22"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&ASIN=B00DT4DY0M&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=morizyun00-22" width="150" style="float: left; margin: 0 20px 20px 0;" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=morizyun00-22&l=as2&o=9&a=B00DT4DY0M" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<strong><a href="https://twitter.com/h5y1m141">@h5y1m141</a></strong>さんに誘って頂いて、
<strong><a href="https://twitter.com/hitomi_tw">@hitomi_tw</a></strong>さんや
<strong><a href="http://qiita.com/shiro615">shiro615</a></strong>さんと一緒に、RubyGemsのソースコードリーディング勉強会『<strong>GemJam</strong>』を行いました。</p>

<p>今回は最近仕事でソースコードを読む時間が増えてきて、苦労していたのでソースコード・リーディングのモチベーションアップやコツを調べつつ、いつもRailsでお世話になっていた『<strong><a href="https://github.com/rails/rails/tree/master/activesupport">ActiveSupport</a></strong>』
のソースコードリーディングに挑戦してみました。</p>

<p><strong>(12/28 12:10) 勉強会のアウトプットを更新しました。全員アウトプットしたのは素晴らしいです</strong></p>

<!-- more -->


<br style="clear:both;"/>


<p>{% include custom/google_ads_yoko_naga.html %}</p>

<h2>プログラムのモチベーション</h2>

<p>これは経験談からくる話なので、これが正解ということでないッス。どちらかと言うと、今までエンジニアとして経験してきた中で、僕個人はこう思っていますという観点で書きました！</p>

<h3>プログラミングは継続する事が一番大切</h3>

<p><strong><a href="http://gigazine.net/news/20130911-180-websites/">プログラミング経験ゼロだが180日で180個のウェブサイトを作るプロジェクトがゴールまであとわずかに</a></strong></p>

<p>プログラミング経験0のデザイナさんが、毎日1つサイトを作っていったお話です。最初はテキストとリンクが並ぶだけのサイトでしたが、少しずつゲームやチャットなどが作れるようになっていきます。</p>

<p>今知っている知識だけで、作れるWebサイトを作っていく。そして、自分の知っている2つの知識を組み合わせたり、１つずつやりたいコトをGoogleに教えてもらうくらいが、挫折せずに続けられると思っています。</p>

<p>個人的に学生さんらにプログラムを教えた事がありますが、プログラムが出来るようになるために一番大切なことは『<strong>継続</strong>』することだと常々実感させられます。</p>

<h3>じゃあ、なぜソースコードを読むのか？</h3>

<p>僕は1人の力には限界があると思います。たった一人で本当に価値のあるソフトウェアを作るのは本当に難しいことだと思います。だから、価値のあるソフトウェアを作っていくためには、他のエンジニアと一緒にプログラムを作り込む必要があると考えています。</p>

<p>そのためには、他の人のソースコードの意味を理解し、他の人にわかりやすいプログラムを書く必要があります。言い換えるとソースコードを読むこと、読みやすいソースコードを知ることが重要だと思います。</p>

<h3>オススメのドキュメント</h3>

<p><strong><a href="http://www.itmedia.co.jp/enterprise/articles/0712/26/news015.html">まつもとゆきひろのハッカーズライフ：第10回 ソースを読もう - ITmedia エンタープライズ</a></strong></p>

<p>Rubyの製作者、まつもとゆきひろさんが2007年に書かれていた記事を見つけました。まつもとさんのソースコードを読む際の動機を垣間見える面白い記事でしたので、良ければぜひご覧になってみてください。</p>

<h2>ソースコードの読み方</h2>

<p>今回『<strong><a href="https://github.com/rails/rails/tree/master/activesupport">ActiveSupport</a></strong>』
のソースコード・リーディングをしてみたので、その時の僕の手順を紹介します。(もしもっといい方法をご存知の方がいれば是非コメントお願いします)</p>

<h4>(1) コードを効率よく読むためのツールを準備する</h4>

<p>まず、オススメのエディタは『<strong><a href="https://www.jetbrains.com/ruby/">RubyMine(などのJetBrains製のエディタ)</a></strong>』です。理由はメソッドのドリルダウンがデフォルトの設定で簡単に行えるからです。1ヶ月無料なのでよかったら是非試してみてください！</p>

<p>次にプロジェクトフォルダ直下で、Gemfile作成して以下の様に追加。</p>

<p>{% codeblock lang:ruby %}
source 'https://rubygems.org'</p>

<h1>debug用</h1>

<p>gem 'pry'</p>

<h1>stackを表示</h1>

<p>gem 'pry-stack_explorer'</p>

<h1>各種便利ユーティリティ</h1>

<p>gem 'activesupport'
{% endcodeblock %}</p>

<p>以下のコマンドを実行して、Gemをインストール。</p>

<p>{% codeblock lang:bash %}</p>

<h1>Gemを追加するためのディレクトリを作成</h1>

<p>mkdir vendor</p>

<h1>Gemをディレクトリに保存</h1>

<p>bundle install --path vendor/bundle --jobs=4
{% endcodeblock %}</p>

<h4>(2) 実際に動かしてみる</h4>

<p>例えば、<code>sample.rb</code>を作成して以下のようにコードを記入。</p>

<p>{% codeblock lang:ruby %}
require 'pry'
require 'pry-byebug'
require 'active_support/all'</p>

<p>puts 2.days.ago
{% endcodeblock %}</p>

<p>これを実行するとactive supportの機能である2日前の日付を取得する事ができます。</p>

<p>{% codeblock lang:bash %}
bunlde exec ruby sample.rb</p>

<h1>=> 2014-12-25 14:09:42 +0900</h1>

<p>{% endcodeblock %}</p>

<h4>(3) デバッガの準備</h4>

<p>次に今回はデバッカを書いて実際に2.daysのメソッドにどんな風に動いているのかを見れるようにします。</p>

<p>まずは、<code>vendor/bundle/ruby/2.1.0/gems/activesupport-4.2.0/lib/active_support/core_ext/numeric/time.rb</code>
を開いて、daysメソッドに以下を追加。</p>

<p>{% codeblock lang:ruby %}
  def days</p>

<pre><code>binding.pry # &lt;= この行を追加
ActiveSupport::Duration.new(self * 24.hours, [[:days, self]])
</code></pre>

<p>  end
{% endcodeblock %}</p>

<p>そしてもう一度以下のコマンドを実行すると今度は、<code>binding.pry</code>を書いた地点で停止します。</p>

<p>{% codeblock lang:bash %}
bunlde exec ruby sample.rb</p>

<h1>デバッカが表示</h1>

<h1>=> From:</h1>

<h1>=>/active_support_reading/vendor/bundle/ruby/2.1.0/gems/activesupport-4.2.0/lib/active_support/core_ext/numeric/time.rb @ line 50 Numeric#days:</h1>

<h1>=></h1>

<h1>=>     49: def days</h1>

<h1>=>  => 50:   binding.pry</h1>

<h1>=>     51:   ActiveSupport::Duration.new(self * 24.hours, [[:days, self]])</h1>

<h1>=>     52: end</h1>

<h1>呼び出しの関係を取得</h1>

<p>2.1.4 (2):0 > show-stack</p>

<h1>=> Showing all accessible frames in stack (2 in total):</h1>

<h1>=> --</h1>

<h1>=> => #0  days &lt;Numeric#days()></h1>

<h1>=>    #1 [main]    <main></h1>

<p>2.1.4 (main):0 > show-source Benchmark.ms</p>

<h1>=></h1>

<h1>=> From:</h1>

<h1>=>/active_support_reading/vendor/bundle/ruby/2.1.0/gems/activesupport-4.2.0/lib/active_support/core_ext/benchmark.rb @ line 11:</h1>

<h1>=> Owner: #&lt;Class:Benchmark></h1>

<h1>=> Visibility: public</h1>

<h1>=> Number of lines: 3</h1>

<h1>=></h1>

<h1>=> def ms</h1>

<h1>=>   1000 * realtime { yield }</h1>

<h1>=> end</h1>

<h1>ここでstepを実行すると処理の中身に移動、nextで次の処理を見ることができる</h1>

<p>{% endcodeblock %}</p>

<p>あとはちょっと変更して見て動かしたりしてみてください。</p>

<h3>どんなふうにソースコードを読み進むべき？</h3>

<p>手始めにどんなふうにソースコードを読んでみたらいいかをいくつかのサイトを調べながら考えてみました。
アイデアレベルですが、よかったらぜひソースコード・リーディング試してみてください！</p>

<pre>
* 普段関わっていたり、仕事に役立つコードを読んだり、コメントを書く
* 興味のある分野や機能を持ったソースコードを読む
  * 全体を読む必要はない。面白そうなところをつまみ食いして、先人の知恵を学べばいい
* ちょっと変更して動作させてみる
* バグがないか探してみる
</pre>


<p>{% include custom/google_ads_yoko_naga.html %}</p>

<h2>ActiveSupportの面白い機能</h2>

<p>『<strong><a href="https://github.com/rails/rails/tree/master/activesupport">ActiveSupport</a></strong>』の
便利機能を調べつつ、その部分のソースコードを読んでみました。今回知らなくって、後で使えそうだった機能を中心に紹介します！</p>

<h3>Benchmark.ms</h3>

<p><code>Benchmark.ms</code>はブロックを渡すとブロックを評価して実行時間を計測します。<br/>
(Benchmark.realtimeのラッパーです)</p>

<p>{% codeblock lang:ruby %}
require 'active_support/all'</p>

<p>puts Benchmark.ms {  sleep 1 } # => 1000.234
{% endcodeblock %}</p>

<h3>cattr_accessor</h3>

<p><code>attr_accessor</code>はインスタンス変数へのアクセッサを提供するメソッド。<br/>
<code>cattr_accessor</code>は、クラス変数へのアクセッサを提供するメソッド。</p>

<p>{% codeblock lang:ruby %}
require 'active_support/all'</p>

<p>class Sample
  cattr_accessor :hoge
end</p>

<p>Sample.hoge = 1
puts Sample.hoge
{% endcodeblock %}</p>

<h3>descendants</h3>

<p>{% codeblock lang:ruby %}
require 'active_support/all'</p>

<p>class Parent
end
class Child &lt; Parent
end
class GrandChild &lt; Child
end</p>

<h1>継承してくれている先を出す</h1>

<p>puts Parent.descendants.to_s #=> [Child, GrandChild]</p>

<h1>継承元を出すメソッド</h1>

<p>puts GrandChild.ancestors.to_s</p>

<h1>=> [GrandChild, Child, Parent, Object, JSON::Ext::Generator::GeneratorMethods::Object, PP::ObjectMixin, Kernel, BasicObject]</h1>

<p>{% endcodeblock %}</p>

<h2>Hash.except</h2>

<p>{% codeblock lang:ruby %}
require 'active_support/all'</p>

<h1>ハッシュから特定のキーを削除</h1>

<p>hash = { hoge: 1, huga: 2 }
puts hash.except(:hoge).to_s # => {:huga => 2}
{% endcodeblock %}</p>

<h2>Time#change</h2>

<p>{% codeblock lang:ruby %}
require 'active_support/all'</p>

<h1>その日の4時0分0秒を取得</h1>

<p>Time.now.change(hour: 4, minute: 0, second: 0) #=> 2014-12-27 04:00:00 +0900
{% endcodeblock %}</p>

<p>ここの記事が大変参考になりました！</p>

<p><strong><a href="http://railsdoc.eiel.info/hiroshimarb/32/">RailsDoc - 広島Ruby勉強 #032 - Rails のソースコード読んだので面白そうなところを紹介する -- ActiveSupport CoreExt編 その1</a></strong></p>

<h2>pry詳解</h2>

<p>今回ソースコードを読んでいて、改めてpryの素晴らしさに感動しました。ということでpryに関する記事を見つけたので紹介です。</p>

<h3>pryの使い方解説</h3>

<ul>
<li><a href="http://qiita.com/muran001/items/e88819681f5325fc44e0">Pryコマンドまとめ - Qiita</a></li>
<li><a href="http://qiita.com/tbpgr/items/a1bbe43b772e35d93987">Ruby の 定番対話ツール pry 徹底攻略 | Normal Input #pry #ruby - Qiita</a></li>
<li><a href="http://qiita.com/tbpgr/items/12a60f2f9e3de61517b5">Ruby の 定番対話ツール pry 徹底攻略 #pry #ruby - Qiita</a></li>
<li><a href="http://qiita.com/k0kubun/items/b118e9ccaef8707c4d9f">Ruby - 今更聞けないpryの使い方と便利プラグイン集 - Qiita</a></li>
<li><a href="http://qiita.com/joker1007/items/42f00b12c65bbec0e50a">pry-docでカジュアルにRubyのソースコードを読む - Qiita</a></li>
<li><a href="http://morizyun.github.io/blog/pry-command-rails-ruby/">Pryが真の力を発揮してくれる19個のコマンドとコマンドの自作方法 - 酒と泪とRubyとRailsと</a></li>
</ul>


<h3>pryの動作原理の解説</h3>

<ul>
<li><a href="http://qiita.com/yui-knk/items/63a511d243323bec6fb8">“binding.pry”って実際のところは何なのだろう - Qiita</a></li>
</ul>


<h2>GemJam勉強会アウトプット</h2>

<h3>GemJamという勉強会を行いました</h3>

<p><strong><a href="https://twitter.com/h5y1m141">@h5y1m141</a></strong>さんが、GemJamを作った背景や、今回調べたことについてブログにまとめて頂けました。4人位のコードリーディングや読書会的な勉強会って結構面白いと実感しました。あと、みんなが終了後1-2日でちゃんとアウトプットしているのはほんとうに素晴らしいです！</p>

<p><strong><a href="http://h5y1m141.hatenablog.com/entry/2014/12/28/111420">GemJamという勉強会を行いました - TitaniumMobile勉強記</a></strong></p>

<h3>GitHubでMergeされたらBacklogもRailsで自動更新する</h3>

<p><strong><a href="https://twitter.com/hitomi_tw">@hitomi_tw</a></strong>さんがActiveSupportのconcernを使いつつ、Backlog APIへのアクセスメソッドを調べて発表してくれました。その際のソースコードをQiitaに公開して頂けたので紹介です！</p>

<p><strong><a href="http://qiita.com/hitomi_/items/12c16d58855fb3536e96">GitHubでMergeされたらBacklogもRailsで自動更新する - Qiita</a></strong></p>

<h3>配列からハッシュを作成/ActiveSupportでHashの一部だけ取り出す</h3>

<p>まだ、プログラムの実務経験はないそうですが、短い時間でアウトプットや発表なんかをしっかりしてくれて、自分の初心者の頃と比べると雲泥の差で素晴らしいと感じました。ぜひプログラムを楽しんでください＾＾</p>

<p><strong><a href="http://qiita.com/shiro615">shiro615 - Qiita</a></strong></p>

<p>{% include custom/google_ads_yoko_naga.html %}</p>

<h2>Special Thanks</h2>

<ul>
<li><a href="http://i.loveruby.net/ja/misc/readingcode.html">ソースコードを読むための技術</a></li>
<li><a href="http://yasuho.hatenablog.com/entry/20060509/p1">ソースコードを効率よく読むには(1) - プログラマyasuhoの隠れ家</a></li>
<li><a href="http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q11110745181">プログラムのソースコードの読み方のコツ最近他人の書いたプログラム... - Yahoo!知恵袋</a></li>
<li><a href="http://www.atmarkit.co.jp/ait/articles/0804/09/news150.html">小山博史のJavaを楽しむ（10）：【新人なるプログラマーへ】ソースコードを読みましょう (1/2) - ＠IT</a></li>
</ul>


<h2>変更来歴</h2>

<p><strong>(12/28 12:10) 勉強会のアウトプットを更新</strong></p>
]]></content>
  </entry>
  
</feed>
